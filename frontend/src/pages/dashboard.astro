---
import AppLayout from "@/layouts/AppLayout.astro";
import TempChart from "@/components/TempChart.tsx";

const { title } = Astro.props;

// Obtener el token de la cookie
const token = Astro.cookies.get('sb-access-token')?.value;

// Datos de ejemplo con timestamps
const tempData = [
  { time: Date.now() - 22 * 60 * 60 * 1000, temperature: 20, sensor: "sensor1" }, // 22h atrás
  { time: Date.now() - 20 * 60 * 60 * 1000, temperature: 19, sensor: "sensor1" }, // 20h atrás
  { time: Date.now() - 18 * 60 * 60 * 1000, temperature: 18, sensor: "sensor1" }, // 18h atrás
  { time: Date.now() - 16 * 60 * 60 * 1000, temperature: 21, sensor: "sensor1" }, // 16h atrás
  { time: Date.now() - 14 * 60 * 60 * 1000, temperature: 24, sensor: "sensor1" }, // 14h atrás
  { time: Date.now() - 12 * 60 * 60 * 1000, temperature: 27, sensor: "sensor1" }, // 12h atrás
  { time: Date.now() - 10 * 60 * 60 * 1000, temperature: 28, sensor: "sensor1" }, // 10h atrás
  { time: Date.now() - 8 * 60 * 60 * 1000, temperature: 26, sensor: "sensor1" },  // 8h atrás
  { time: Date.now() - 6 * 60 * 60 * 1000, temperature: 25, sensor: "sensor1" },  // 6h atrás
  { time: Date.now() - 4 * 60 * 60 * 1000, temperature: 23, sensor: "sensor1" },  // 4h atrás
  { time: Date.now() - 2 * 60 * 60 * 1000, temperature: 22, sensor: "sensor1" },  // 2h atrás
  { time: Date.now(), temperature: 21, sensor: "sensor1" },                       // ahora
];
---

<AppLayout title="Dashboard">
    <h1>Dashboard IoT - Temperatura</h1>
    <section>
        <div>
            <h2>Resumen</h2>
            <ul>
                <li>Temperatura promedio: 23°C</li>
                <li>Máxima hoy: 28°C</li>
                <li>Mínima hoy: 18°C</li>
                <li>Dispositivos conectados: 5</li>
            </ul>
        </div>
        <div>
            <h2>Gráfica de temperatura (24h)</h2>
            <TempChart data={tempData} client:load />
        </div>
        <div>
            <h2>Alertas recientes</h2>
            <ul>
                <li>Sensor 2 fuera de rango (30°C)</li>
                <li>Sensor 4 desconectado</li>
            </ul>
        </div>
        <div>
            <h2>Dispositivos</h2>
            <ul>
                <li>Sensor 1: 22°C (OK)</li>
                <li>Sensor 2: 30°C (Alerta)</li>
                <!-- ... -->
            </ul>
            <a href="/devices">Administrar dispositivos</a>
        </div>
    </section>
</AppLayout>